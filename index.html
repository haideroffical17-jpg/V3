<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Animator - 5 Sec Videos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 42px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 14px;
            margin-top: 10px;
        }

        .main-panel {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .setting label {
            display: block;
            font-size: 13px;
            font-weight: 700;
            color: #495057;
            margin-bottom: 8px;
        }

        .setting select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            background: white;
        }

        .prompts-section {
            margin-bottom: 25px;
        }

        .prompts-section label {
            display: block;
            font-size: 13px;
            font-weight: 700;
            color: #495057;
            margin-bottom: 8px;
        }

        .prompts-textarea {
            width: 100%;
            min-height: 300px;
            padding: 18px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 15px;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
            resize: vertical;
        }

        .prompts-info {
            margin-top: 10px;
            padding: 12px;
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            font-size: 14px;
            color: #856404;
            font-weight: 600;
        }

        .generate-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 18px;
            font-weight: 900;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-panel {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
        }

        .progress-panel.active {
            display: block;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-title {
            font-size: 18px;
            font-weight: 800;
            color: #2d3748;
        }

        .progress-timer {
            font-size: 20px;
            font-weight: 900;
            color: #667eea;
        }

        .progress-bar-container {
            width: 100%;
            height: 35px;
            background: #e9ecef;
            border-radius: 18px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00b09b, #96c93d);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: white;
            font-size: 14px;
        }

        .current-task {
            font-size: 14px;
            color: #6c757d;
            font-weight: 600;
        }

        .results-panel {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .results-title {
            font-size: 24px;
            font-weight: 900;
            color: #2d3748;
        }

        .results-actions {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .download-all-btn {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
        }

        .clear-btn {
            background: #dc3545;
            color: white;
        }

        .videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .video-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .video-preview {
            width: 100%;
            height: 280px;
            background: #000;
            position: relative;
        }

        .video-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-info {
            padding: 18px;
        }

        .video-number {
            font-size: 12px;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 8px;
        }

        .video-prompt {
            font-size: 14px;
            color: #495057;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-badge {
            padding: 6px 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 800;
        }

        .download-btn {
            padding: 8px 18px;
            background: linear-gradient(135deg, #00b09b, #96c93d);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 800;
            cursor: pointer;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #adb5bd;
        }

        .empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Image Animator - 5 Sec Videos</h1>
            <p style="color: #6c757d; font-size: 16px; margin-top: 8px;">
                Single Image ‚Üí Animated Video (Zoom, Pan, Ken Burns Effect)
            </p>
            <div class="badge">‚úÖ RELIABLE ‚Ä¢ NO ENCODING ISSUES ‚Ä¢ UNLIMITED PROMPTS</div>
        </div>

        <div class="main-panel">
            <div class="settings">
                <div class="setting">
                    <label>Aspect Ratio</label>
                    <select id="ratio">
                        <option value="16:9">16:9 - YouTube (1024x576)</option>
                        <option value="9:16">9:16 - TikTok (576x1024)</option>
                        <option value="1:1">1:1 - Instagram (1024x1024)</option>
                    </select>
                </div>
                <div class="setting">
                    <label>Animation Style</label>
                    <select id="animation">
                        <option value="zoom">Zoom In + Pan</option>
                        <option value="ken">Ken Burns Effect</option>
                        <option value="slide">Slide + Rotate</option>
                    </select>
                </div>
                <div class="setting">
                    <label>Duration</label>
                    <select id="duration">
                        <option value="5" selected>5 Seconds</option>
                    </select>
                </div>
            </div>

            <div class="prompts-section">
                <label>üé¨ Video Prompts (Unlimited - One Per Line)</label>
                <textarea id="prompts" class="prompts-textarea" placeholder="Enter unlimited prompts (one per line):

Lion walking through golden savanna at sunset
Majestic eagle soaring over snow-capped mountains
Luxury sports car racing on coastal highway
Astronaut floating in space with Earth in background
Ancient castle on misty mountain peak
Cherry blossoms falling in Japanese garden
Northern lights dancing over frozen lake
Tropical beach with crystal clear turquoise water
Medieval knight in shining armor
Futuristic cityscape with flying cars

üí° Tips:
- Each line = 1 video (5 seconds)
- Detailed descriptions work best
- Mention lighting, mood, atmosphere
- No limit on number of prompts!"></textarea>
                <div class="prompts-info" id="promptsInfo">
                    üìä 0 videos will be created
                </div>
            </div>

            <button class="generate-btn" id="generateBtn" disabled>
                üöÄ Generate All Videos (5 Sec Each)
            </button>
        </div>

        <div class="progress-panel" id="progressPanel">
            <div class="progress-header">
                <div class="progress-title" id="progressTitle">Creating videos...</div>
                <div class="progress-timer" id="progressTimer">00:00</div>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar">0%</div>
            </div>
            <div class="current-task" id="currentTask">Preparing...</div>
        </div>

        <div class="results-panel">
            <div class="results-header">
                <h2 class="results-title">üìπ Generated Videos (<span id="videoCount">0</span>)</h2>
                <div class="results-actions">
                    <button class="action-btn download-all-btn" id="downloadAllBtn" style="display:none;">
                        üì• Download All
                    </button>
                    <button class="action-btn clear-btn" id="clearBtn" style="display:none;">
                        üóëÔ∏è Clear All
                    </button>
                </div>
            </div>

            <div class="videos-grid" id="videosGrid">
                <div class="empty-state">
                    <div class="empty-icon">üé¨</div>
                    <h3>No videos yet</h3>
                    <p>Enter prompts above and click Generate!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const promptsInput = document.getElementById('prompts');
        const promptsInfo = document.getElementById('promptsInfo');
        const generateBtn = document.getElementById('generateBtn');
        const progressPanel = document.getElementById('progressPanel');
        const progressTitle = document.getElementById('progressTitle');
        const progressTimer = document.getElementById('progressTimer');
        const progressBar = document.getElementById('progressBar');
        const currentTask = document.getElementById('currentTask');
        const videosGrid = document.getElementById('videosGrid');
        const videoCount = document.getElementById('videoCount');
        const downloadAllBtn = document.getElementById('downloadAllBtn');
        const clearBtn = document.getElementById('clearBtn');
        const ratioSelect = document.getElementById('ratio');
        const animationSelect = document.getElementById('animation');

        let videos = [];

        // Update prompts counter
        promptsInput.addEventListener('input', () => {
            const lines = promptsInput.value.split('\n').filter(l => l.trim());
            promptsInfo.innerHTML = `üìä <strong>${lines.length}</strong> video${lines.length !== 1 ? 's' : ''} will be created (${lines.length * 5} seconds total)`;
            generateBtn.disabled = lines.length === 0;
        });

        // Generate videos
        generateBtn.addEventListener('click', async () => {
            const prompts = promptsInput.value.split('\n').filter(l => l.trim());
            if (prompts.length === 0) return;

            console.log(`\nüé¨ Starting generation of ${prompts.length} videos...`);

            // Reset
            videosGrid.innerHTML = '';
            videos = [];
            videoCount.textContent = '0';
            downloadAllBtn.style.display = 'none';
            clearBtn.style.display = 'none';

            // Show progress
            progressPanel.classList.add('active');
            generateBtn.disabled = true;

            const startTime = Date.now();
            const timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const mins = String(Math.floor(elapsed / 60)).padStart(2, '0');
                const secs = String(elapsed % 60).padStart(2, '0');
                progressTimer.textContent = `${mins}:${secs}`;
            }, 1000);

            // Generate each video
            for (let i = 0; i < prompts.length; i++) {
                const num = i + 1;
                const percent = Math.round((num / prompts.length) * 100);

                progressTitle.textContent = `Creating video ${num} of ${prompts.length}`;
                progressBar.style.width = `${percent}%`;
                progressBar.textContent = `${percent}%`;
                currentTask.textContent = `üì∏ Generating image & animating: ${prompts[i].substring(0, 60)}...`;

                console.log(`\n=== VIDEO ${num}/${prompts.length} ===`);
                console.log(`Prompt: "${prompts[i]}"`);

                try {
                    const blob = await createAnimatedVideo(prompts[i], i);
                    if (blob) {
                        console.log(`‚úÖ SUCCESS! Video ${num} (${(blob.size/1024/1024).toFixed(2)}MB)`);
                        addVideoCard(prompts[i], blob, num);
                    }
                } catch (err) {
                    console.error(`‚ùå ERROR! Video ${num}:`, err);
                }
            }

            // Complete
            clearInterval(timerInterval);
            progressPanel.classList.remove('active');
            generateBtn.disabled = false;
            downloadAllBtn.style.display = videos.length > 0 ? 'block' : 'none';
            clearBtn.style.display = videos.length > 0 ? 'block' : 'none';

            console.log(`\n‚úÖ COMPLETE! Created ${videos.length}/${prompts.length} videos`);
        });

        // Create animated video from single image
        async function createAnimatedVideo(prompt, seed) {
            // Get dimensions
            const ratio = ratioSelect.value;
            let w, h;
            if (ratio === '16:9') { w = 1024; h = 576; }
            else if (ratio === '9:16') { w = 576; h = 1024; }
            else { w = 1024; h = 1024; }

            console.log(`Canvas: ${w}x${h}`);

            // Generate single image
            const imgSeed = Date.now() + seed * 1000;
            const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=${w}&height=${h}&seed=${imgSeed}&nologo=true&enhance=true`;
            
            console.log('Loading image...');
            const img = await loadImage(url);
            if (!img) {
                console.error('Image failed to load');
                return null;
            }
            console.log('Image loaded ‚úì');

            // Create canvas
            const canvas = document.createElement('canvas');
            canvas.width = w;
            canvas.height = h;
            const ctx = canvas.getContext('2d');

            const stream = canvas.captureStream(30);
            const recorder = new MediaRecorder(stream, {
                mimeType: 'video/webm;codecs=vp9',
                videoBitsPerSecond: 2500000
            });

            const chunks = [];
            recorder.ondataavailable = e => {
                if (e.data && e.data.size > 0) chunks.push(e.data);
            };

            return new Promise((resolve) => {
                recorder.onstop = () => {
                    if (chunks.length > 0) {
                        const blob = new Blob(chunks, { type: 'video/webm' });
                        resolve(blob);
                    } else {
                        resolve(null);
                    }
                };

                recorder.start(100);
                console.log('Recording started');

                const animStyle = animationSelect.value;
                const start = performance.now();
                const duration = 5000;

                function animate() {
                    const elapsed = performance.now() - start;

                    if (elapsed >= duration) {
                        console.log('Recording complete');
                        recorder.stop();
                        return;
                    }

                    const progress = elapsed / duration;

                    ctx.clearRect(0, 0, w, h);

                    // Apply animation based on style
                    if (animStyle === 'zoom') {
                        // Zoom in + pan
                        const scale = 1 + progress * 0.3; // Zoom from 1x to 1.3x
                        const panX = Math.sin(progress * Math.PI) * 50;
                        const panY = Math.cos(progress * Math.PI) * 30;

                        ctx.save();
                        ctx.translate(w/2, h/2);
                        ctx.scale(scale, scale);
                        ctx.translate(-w/2 + panX, -h/2 + panY);
                        ctx.drawImage(img, 0, 0, w, h);
                        ctx.restore();
                    } else if (animStyle === 'ken') {
                        // Ken Burns effect
                        const scale = 1 + Math.sin(progress * Math.PI) * 0.2;
                        const panX = progress * 100 - 50;
                        const panY = Math.sin(progress * Math.PI * 2) * 30;

                        ctx.save();
                        ctx.translate(w/2, h/2);
                        ctx.scale(scale, scale);
                        ctx.translate(-w/2 + panX, -h/2 + panY);
                        ctx.drawImage(img, 0, 0, w, h);
                        ctx.restore();
                    } else {
                        // Slide + rotate
                        const translateX = Math.sin(progress * Math.PI * 2) * 40;
                        const translateY = Math.cos(progress * Math.PI * 2) * 40;
                        const rotate = Math.sin(progress * Math.PI) * 0.05;
                        const scale = 1 + Math.sin(progress * Math.PI) * 0.15;

                        ctx.save();
                        ctx.translate(w/2 + translateX, h/2 + translateY);
                        ctx.rotate(rotate);
                        ctx.scale(scale, scale);
                        ctx.translate(-w/2, -h/2);
                        ctx.drawImage(img, 0, 0, w, h);
                        ctx.restore();
                    }

                    // Fade in/out
                    if (elapsed < 300) {
                        ctx.fillStyle = `rgba(0,0,0,${1 - elapsed/300})`;
                        ctx.fillRect(0, 0, w, h);
                    } else if (elapsed > duration - 300) {
                        ctx.fillStyle = `rgba(0,0,0,${(elapsed-(duration-300))/300})`;
                        ctx.fillRect(0, 0, w, h);
                    }

                    requestAnimationFrame(animate);
                }

                animate();

                // Safety timeout
                setTimeout(() => {
                    if (recorder.state === 'recording') {
                        recorder.stop();
                    }
                }, duration + 500);
            });
        }

        // Load image helper
        function loadImage(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';

                const timeout = setTimeout(() => resolve(null), 15000);

                img.onload = () => {
                    clearTimeout(timeout);
                    resolve(img);
                };

                img.onerror = () => {
                    clearTimeout(timeout);
                    resolve(null);
                };

                img.src = url;
            });
        }

        // Add video card
        function addVideoCard(prompt, blob, num) {
            const url = URL.createObjectURL(blob);
            videos.push({ prompt, blob, url });
            videoCount.textContent = videos.length;

            const card = document.createElement('div');
            card.className = 'video-card';
            card.innerHTML = `
                <div class="video-preview">
                    <video controls loop muted>
                        <source src="${url}" type="video/webm">
                    </video>
                </div>
                <div class="video-info">
                    <div class="video-number">Video #${num}</div>
                    <div class="video-prompt">${prompt}</div>
                    <div class="video-meta">
                        <span class="video-badge">${ratioSelect.value} ‚Ä¢ 5s ‚Ä¢ Animated</span>
                        <button class="download-btn" onclick="downloadVideo(${videos.length - 1})">
                            üì• Download
                        </button>
                    </div>
                </div>
            `;

            videosGrid.appendChild(card);
        }

        // Download single video
        window.downloadVideo = function(index) {
            const video = videos[index];
            const link = document.createElement('a');
            link.href = video.url;
            link.download = `animated-video-${index + 1}.webm`;
            link.click();
        };

        // Download all
        downloadAllBtn.addEventListener('click', async () => {
            for (let i = 0; i < videos.length; i++) {
                downloadVideo(i);
                await new Promise(r => setTimeout(r, 500));
            }
        });

        // Clear all
        clearBtn.addEventListener('click', () => {
            if (confirm(`Clear all ${videos.length} videos?`)) {
                videos.forEach(v => URL.revokeObjectURL(v.url));
                videos = [];
                videosGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üé¨</div>
                        <h3>No videos yet</h3>
                        <p>Enter prompts above and click Generate!</p>
                    </div>
                `;
                videoCount.textContent = '0';
                downloadAllBtn.style.display = 'none';
                clearBtn.style.display = 'none';
            }
        });
    </script>
</body>
</html>
